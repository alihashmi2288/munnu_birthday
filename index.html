<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Happy Birthday, Muntsha!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    @keyframes cardFlip {
      0% { transform: rotateY(0deg) scale(1); }
      50% { transform: rotateY(90deg) scale(1.05); }
      100% { transform: rotateY(180deg) scale(1); }
    }
    
    @keyframes cardMatch {
      0% { transform: rotateY(180deg) scale(1); }
      50% { transform: rotateY(180deg) scale(1.2); }
      100% { transform: rotateY(180deg) scale(1.1); }
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-10px); }
      60% { transform: translateY(-5px); }
    }
    
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    @keyframes modalAppear {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    
    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    @keyframes sparkle {
      0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
      50% { opacity: 1; transform: scale(1) rotate(180deg); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    .heart-beat {
      animation: heartBeat 1.5s ease-in-out infinite;
    }
    
    .sparkle-effect {
      position: relative;
      overflow: hidden;
    }
    
    .sparkle-effect::before {
      content: '‚ú®';
      position: absolute;
      top: 10%;
      left: 10%;
      animation: sparkle 2s ease-in-out infinite;
    }
    
    .sparkle-effect::after {
      content: '‚≠ê';
      position: absolute;
      top: 20%;
      right: 15%;
      animation: sparkle 2s ease-in-out infinite 0.5s;
    }
    
    .float-animation {
      animation: float 3s ease-in-out infinite;
    }
    
    .text-glow {
      text-shadow: 0 0 10px rgba(255, 105, 180, 0.6);
    }
    

    

    
    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(1deg); }
      75% { transform: rotate(-1deg); }
    }
    

    
    .card-hover {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .wiggle {
      animation: wiggle 0.5s ease-in-out;
    }
    
    @keyframes confetti {
      0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
    
    @keyframes partyPopper {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
      100% { transform: scale(0) rotate(360deg); opacity: 0; }
    }
    
    .confetti-piece {
      position: fixed;
      width: 10px;
      height: 10px;
      z-index: 1000;
      pointer-events: none;
      animation: confetti 3s linear forwards;
    }
    
    .party-popper {
      position: fixed;
      font-size: 3rem;
      z-index: 1000;
      pointer-events: none;
      animation: partyPopper 1s ease-out forwards;
    }

    body {
      background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
    }

    .card-container {
      perspective: 1000px;
      animation: slideUp 0.6s ease-out forwards;
      animation-delay: calc(var(--delay) * 0.1s);
      opacity: 0;
    }

    .game-card {
      transform-style: preserve-3d;
      transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .game-card:hover {
      transform: translateY(-4px) scale(1.05);
    }

    .game-card.flipped {
      animation: cardFlip 0.6s ease-in-out forwards;
    }

    .game-card.matched {
      animation: cardMatch 0.6s ease-out forwards;
      pointer-events: none;
    }

    .card-face {
      backface-visibility: hidden;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
    }

    .card-front {
      transform: rotateY(180deg);
    }

    .title-gradient {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #ff6b9d 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: pulse 3s ease-in-out infinite;
      filter: drop-shadow(0 2px 4px rgba(240, 147, 251, 0.3));
    }

    .stats-bounce {
      animation: bounce 2s ease-in-out infinite;
    }

    .modal-content {
      animation: modalAppear 0.5s ease-out;
    }

    .btn-gradient {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      transition: all 0.3s ease;
    }

    .btn-gradient:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(240, 147, 251, 0.4);
    }

    .card-gradient-1 {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .card-gradient-2 {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .card-gradient-3 {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      box-shadow: 0 0 20px rgba(79, 172, 254, 0.4);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-1 overflow-hidden">
  <div class="bg-white/95 backdrop-blur-sm rounded-3xl p-4 w-full max-w-sm shadow-2xl">
    <!-- Header -->
    <div class="text-center mb-3">
      <h1 class="title-gradient text-2xl md:text-3xl font-bold mb-1">
        üéâ Happy Birthday, Muntsha! üéâ
      </h1>
      <p class="text-gray-600 text-xs md:text-sm mb-1">
       A little memory game for you. Find all the matching pairs!
      </p>
      <p class="text-purple-600 text-xs italic font-semibold">
      Fun fact: Muntsha loves purple and surprises! üéà
      </p>
    </div>

    <!-- Game Board -->
    <div id="game-board" class="grid grid-cols-4 gap-2 md:gap-3 mb-4 justify-items-center mx-auto">
    </div>

    <!-- Stats -->
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl p-3 mb-4">
      <div class="flex justify-between items-center text-xs md:text-sm font-bold">
        <div class="text-gray-700">
          <span class="text-purple-600">Moves:</span> 
          <span id="move-counter" class="text-pink-600 stats-bounce">0</span>
        </div>
        <div class="text-gray-700">
          <span class="text-purple-600">Pairs:</span> 
          <span id="pairs-found" class="text-pink-600 stats-bounce">0</span>/6
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="text-center">
      <div class="flex gap-2 justify-center mb-2">
        <button onclick="window.location.href='adventure.html'" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-full text-xs shadow-lg">
          ‚Üê Back
        </button>
        <button id="restart-button" class="btn-gradient text-white font-bold py-2 px-4 rounded-full text-xs md:text-sm shadow-lg border border-white/20">
          üéÆ Restart üéÆ
        </button>
      </div>
      <p class="text-xs text-gray-500">
        Made by <span class="text-purple-600 font-bold">Syed Ali Hashmi</span>
      </p>
    </div>
  </div>

  <!-- Modal -->
  <div id="message-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-2 z-50 hidden">
    <div class="modal-content bg-gradient-to-br from-pink-50 to-purple-50 rounded-2xl p-4 max-w-sm w-full text-center sparkle-effect border-2 border-pink-200 shadow-2xl max-h-screen overflow-y-auto">
      <div class="float-animation">
        <img src="WhatsApp Image 2025-09-13 at 15.21.36_5518dbbf.jpg" 
             alt="Muntsha" 
             class="w-24 h-24 md:w-32 md:h-32 rounded-full object-cover mx-auto mb-4 shadow-xl border-2 border-pink-300 heart-beat">
      </div>
      
      <h2 class="text-xl md:text-3xl font-bold bg-gradient-to-r from-pink-500 via-purple-500 to-pink-600 bg-clip-text text-transparent mb-3 heart-beat text-glow">
        üéâ üéÇ Happy Birthday, Muntsha! üéÇ üéâ
      </h2>
      
      <div class="bg-white/70 backdrop-blur-sm rounded-xl p-3 mb-4 shadow-inner">
        <p class="text-gray-800 leading-relaxed text-sm md:text-base font-medium">
          <span class="text-lg animate-bounce">üíñ</span> <strong class="text-pink-600 text-glow">Happy Birthday, my love!</strong> <span class="text-lg animate-bounce">üíñ</span><br><br>
          <span class="text-purple-700 font-bold">Muntsha</span>, you are the <em class="text-pink-600 font-semibold">best thing</em> that has ever happened to me. I love you with all my <strong class="text-red-500 text-glow">heart and soul</strong>. Sometimes I wish I could open my heart so you could see how deeply I feel for you.<br><br>
          I'm truly the <strong class="text-green-600 font-bold">luckiest person</strong> to have you in my life. May <span class="text-blue-600 font-semibold">Allah</span> always bless you with <em class="text-yellow-600 font-medium">happiness</em>, <em class="text-green-600 font-medium">health</em>, and <em class="text-purple-600 font-medium">endless joy</em>.<br><br>
          <strong class="text-pink-700 text-lg font-bold text-glow">‚ú® You mean everything to me. ‚ú®</strong>
        </p>
      </div>
      
      <button id="close-modal" class="btn-gradient text-white font-bold py-2 px-6 rounded-full shadow-xl transform hover:scale-105 transition-all duration-300 text-sm">
        üéÆ Play Again üéÆ
      </button>
    </div>
  </div>

  <script>
    // Redirect to adventure page if not coming from there
    if (!document.referrer.includes('adventure.html') && !sessionStorage.getItem('fromAdventure')) {
      window.location.href = 'adventure.html';
    }
    
    const gameBoard = document.getElementById('game-board');
    const restartButton = document.getElementById('restart-button');
    const moveCounter = document.getElementById('move-counter');
    const pairsFound = document.getElementById('pairs-found');
    const messageModal = document.getElementById('message-modal');
    const closeModalButton = document.getElementById('close-modal');

    const cardEmojis = ['üéÇ','üéà','üéÅ','üéâ','üíñ','üç∞'];
    const cardArray = [...cardEmojis, ...cardEmojis];

    let cardsChosen = [];
    let cardsChosenId = [];
    let cardsWon = [];
    let moves = 0;
    let boardLocked = false;
    let isProcessing = false;
    let clickCooldown = false;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    // Audio setup
    let audioContext = null;
    
    function initAudio() {
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
          console.warn('Audio not supported');
        }
      }
      return audioContext;
    }

    function playFlipSound() {
      const ctx = initAudio();
      if (!ctx) return;
      
      try {
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.15, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
        
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.15);
      } catch (e) {}
    }

    function playMatchSound() {
      const ctx = initAudio();
      if (!ctx) return;
      
      try {
        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);
        
        oscillator.frequency.value = 1200;
        oscillator.type = 'triangle';
        gainNode.gain.setValueAtTime(0.2, ctx.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.4);
        
        oscillator.start(ctx.currentTime);
        oscillator.stop(ctx.currentTime + 0.4);
      } catch (e) {}
    }

    function playHappyBirthdayMelody() {
      const ctx = initAudio();
      if (!ctx) return;
      
      try {
        // Happy Birthday melody notes (C4, C4, D4, C4, F4, E4, C4, C4, D4, C4, G4, F4)
        const melody = [
          {freq: 261.63, duration: 0.5}, // C4 - Hap-
          {freq: 261.63, duration: 0.3}, // C4 - py
          {freq: 293.66, duration: 0.7}, // D4 - Birth-
          {freq: 261.63, duration: 0.7}, // C4 - day
          {freq: 349.23, duration: 0.7}, // F4 - to
          {freq: 329.63, duration: 1.0}, // E4 - you
          {freq: 261.63, duration: 0.5}, // C4 - Hap-
          {freq: 261.63, duration: 0.3}, // C4 - py
          {freq: 293.66, duration: 0.7}, // D4 - Birth-
          {freq: 261.63, duration: 0.7}, // C4 - day
          {freq: 392.00, duration: 0.7}, // G4 - to
          {freq: 349.23, duration: 1.0}  // F4 - you
        ];
        
        let currentTime = ctx.currentTime;
        
        melody.forEach((note) => {
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);
          
          oscillator.frequency.value = note.freq;
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.3, currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.001, currentTime + note.duration);
          
          oscillator.start(currentTime);
          oscillator.stop(currentTime + note.duration);
          
          currentTime += note.duration + 0.1;
        });
      } catch (e) {}
    }

    function playVictoryMusic() {
      const ctx = initAudio();
      if (!ctx) return;
      
      try {
        const notes = [523, 659, 784, 1047, 784, 659, 523];
        
        notes.forEach((freq, i) => {
          const oscillator = ctx.createOscillator();
          const gainNode = ctx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(ctx.destination);
          
          oscillator.frequency.value = freq;
          oscillator.type = 'sine';
          
          const startTime = ctx.currentTime + i * 0.2;
          gainNode.gain.setValueAtTime(0.25, startTime);
          gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + 0.4);
          
          oscillator.start(startTime);
          oscillator.stop(startTime + 0.4);
        });
      } catch (e) {}
    }

    // Animation functions
    function createConfetti() {
      const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd700', '#ff69b4', '#98fb98'];
      
      for (let i = 0; i < 50; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti-piece';
          confetti.style.left = Math.random() * 100 + 'vw';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 2 + 's';
          confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
          
          document.body.appendChild(confetti);
          
          setTimeout(() => confetti.remove(), 3000);
        }, i * 50);
      }
    }

    function createPartyPoppers() {
      const poppers = ['üéâ', 'üéä', '‚ú®', 'üéÜ'];
      
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          const popper = document.createElement('div');
          popper.className = 'party-popper';
          popper.textContent = poppers[Math.floor(Math.random() * poppers.length)];
          popper.style.left = Math.random() * 80 + 10 + 'vw';
          popper.style.top = Math.random() * 80 + 10 + 'vh';
          
          document.body.appendChild(popper);
          
          setTimeout(() => popper.remove(), 1000);
        }, i * 200);
      }
    }

    function createBoard() {
      cardsWon = [];
      moves = 0;
      moveCounter.textContent = moves;
      pairsFound.textContent = cardsWon.length;
      gameBoard.innerHTML = '';
      shuffle(cardArray);

      // Adjust grid for mobile
      if (window.innerWidth < 480) {
        gameBoard.className = 'grid grid-cols-3 gap-2 mb-4 justify-items-center mx-auto';
      } else {
        gameBoard.className = 'grid grid-cols-4 gap-2 md:gap-3 mb-4 justify-items-center mx-auto';
      }

      for (let i = 0; i < cardArray.length; i++) {
        const cardContainer = document.createElement('div');
        cardContainer.className = 'card-container';
        cardContainer.style.setProperty('--delay', i);

        const card = document.createElement('div');
        card.className = `game-card relative w-14 h-14 md:w-16 md:h-16 rounded-xl cursor-pointer shadow-lg card-hover ${window.innerWidth < 480 ? 'w-12 h-12' : ''}`;
        card.setAttribute('data-id', i);
        card.setAttribute('data-name', cardArray[i]);

        const cardFront = document.createElement('div');
        cardFront.className = 'card-face card-front card-gradient-1 rounded-xl flex items-center justify-center text-2xl md:text-3xl text-white shadow-inner';
        cardFront.textContent = cardArray[i];

        const cardBack = document.createElement('div');
        cardBack.className = 'card-face card-gradient-2 rounded-xl flex items-center justify-center text-2xl md:text-3xl text-white shadow-inner';
        cardBack.textContent = 'üéÄ';

        card.appendChild(cardFront);
        card.appendChild(cardBack);
        cardContainer.appendChild(card);
        card.addEventListener('click', flipCard);
        gameBoard.appendChild(cardContainer);
      }
    }

    function flipCard(event) {
      // Prevent rapid clicking and multiple card flips
      if (boardLocked || isProcessing || clickCooldown) return;
      
      const card = event.target.closest('.game-card');
      if (!card) return;
      
      const cardId = card.getAttribute('data-id');

      if (card.classList.contains('matched') || card.classList.contains('flipped') || cardsChosenId.includes(cardId)) {
        return;
      }

      // Prevent more than 2 cards being selected
      if (cardsChosen.length >= 2) return;

      // Set cooldown to prevent rapid clicking
      clickCooldown = true;
      setTimeout(() => clickCooldown = false, 150);

      if (!audioContext) {
        initAudio();
      }
      
      playFlipSound();
      card.classList.add('flipped');
      const cardName = card.getAttribute('data-name');
      cardsChosen.push(cardName);
      cardsChosenId.push(cardId);

      if (cardsChosen.length === 2) {
        isProcessing = true;
        boardLocked = true;
        moves++;
        moveCounter.textContent = moves;
        setTimeout(checkForMatch, 400);
      }
    }

    function checkForMatch() {
      const cards = document.querySelectorAll('.game-card');
      const optionOneId = cardsChosenId[0];
      const optionTwoId = cardsChosenId[1];

      if (optionOneId === optionTwoId) {
        setTimeout(() => {
          cards[optionOneId].classList.remove('flipped');
          resetGameState();
        }, 300);
      } else if (cardsChosen[0] === cardsChosen[1]) {
        const cardOne = cards[optionOneId];
        const cardTwo = cards[optionTwoId];
        
        playMatchSound();
        
        cardOne.classList.add('matched');
        cardTwo.classList.add('matched');
        
        const frontOne = cardOne.querySelector('.card-front');
        const frontTwo = cardTwo.querySelector('.card-front');
        frontOne.className = frontOne.className.replace('card-gradient-1', 'card-gradient-3');
        frontTwo.className = frontTwo.className.replace('card-gradient-1', 'card-gradient-3');
        
        cardOne.style.boxShadow = '0 0 20px rgba(79, 172, 254, 0.6)';
        cardTwo.style.boxShadow = '0 0 20px rgba(79, 172, 254, 0.6)';
        
        cardsWon.push(cardsChosen);
        pairsFound.textContent = cardsWon.length;

        setTimeout(() => {
          resetGameState();
          if (cardsWon.length === cardEmojis.length) {
            playVictoryMusic();
            createConfetti();
            createPartyPoppers();
            setTimeout(() => {
              messageModal.classList.remove('hidden');
              playHappyBirthdayMelody();
            }, 600);
          }
        }, 500);
      } else {
        setTimeout(() => {
          cards[optionOneId].classList.remove('flipped');
          cards[optionTwoId].classList.remove('flipped');
          resetGameState();
        }, 800);
      }
    }

    function resetGameState() {
      cardsChosen = [];
      cardsChosenId = [];
      boardLocked = false;
      isProcessing = false;
    }

    restartButton.addEventListener('click', () => {
      messageModal.classList.add('hidden');
      createBoard();
    });

    closeModalButton.addEventListener('click', () => {
      messageModal.classList.add('hidden');
      createBoard();
    });

    // Handle window resize with debounce
    let resizeTimeout;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        const currentCols = window.innerWidth < 480 ? 3 : 4;
        const boardCols = gameBoard.className.includes('grid-cols-3') ? 3 : 4;
        if (currentCols !== boardCols && gameBoard.children.length > 0) {
          createBoard();
        }
      }, 250);
    });

    createBoard();
  </script>
</body>
</html>